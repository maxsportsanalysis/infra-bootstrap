---
- name: Enable PostgreSQL setup script repository installation
  ansible.builtin.command:
    cmd: /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh -y
  args:
    creates: /etc/apt/sources.list.d/pgdg.list
  register: pgdg_repo
  changed_when: "'Adding the repository' in pgdg_repo.stdout or 'added' in pgdg_repo.stdout"

- name: Install PostgreSQL server and client
  ansible.builtin.apt:
    name:
      - "postgresql-{{ postgres_version }}"
      - "postgresql-client-{{ postgres_version }}"
    state: present
    update_cache: yes

- name: Ensure PostgreSQL is installed but not running
  ansible.builtin.service:
    name: postgresql
    state: stopped
    enabled: yes